{{- if and (not .Values.keyVault.enabled) (or .Values.secrets (and .Values.blueGreen.enabled (or (index .Values.blueGreen.colors "blue").secrets (index .Values.blueGreen.colors "green").secrets))) }}
{{- if .Values.blueGreen.enabled }}
{{- range $color, $config := .Values.blueGreen.colors }}
{{- if and $config.enabled (or $.Values.secrets $config.secrets) }}
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "service.secretNameForColor" (dict "root" $ "color" $color) }}
  namespace: {{ $.Values.namespace }}
  labels:
    {{- include "service.labels" $ | nindent 4 }}
    version: {{ $color }}
type: Opaque
data:
  {{- if $.Values.secrets }}
  {{- range $key, $value := $.Values.secrets }}
  {{ $key }}: {{ $value | b64enc }}
  {{- end }}
  {{- end }}
  {{- if $config.secrets }}
  {{- range $key, $value := $config.secrets }}
  {{ $key }}: {{ $value | b64enc }}
  {{- end }}
  {{- end }}
{{- end }}
{{- end }}
{{- else }}
# Standard Secret for non-blue-green environments
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "service.fullname" . }}-secret
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "service.labels" . | nindent 4 }}
type: Opaque
data:
  {{- range $key, $value := .Values.secrets }}
  {{ $key }}: {{ $value | b64enc }}
  {{- end }}
{{- end }}
{{- end }}